<!DOCTYPE html>
<html lang="es">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVTW1307T1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-EVTW1307T1');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laravel ORM Eloquent</title>
  <script src="/course-resources/index.js" defer></script>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script src="https://kit.fontawesome.com/a7cd9537ed.js" crossorigin="anonymous"></script>
  <script src="../index.js" defer></script>
  <script src="../menu.js" defer></script>
  <!-- <link rel="stylesheet" href="../index.css"> -->
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../menu.css">
</head>


<body>


  <nav id="vc-rail" class="vc-rail" aria-hidden="true">
    <div class="vc-rail-head">
      <span class="vc-rail-title">Índice</span>
      <button id="vc-close" class="vc-btn" aria-label="Cerrar menú">
        <!-- X SVG -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    </div>
    <ul id="vc-list" class="vc-list"></ul>
  </nav>

  <div id="vc-backdrop" class="vc-backdrop" hidden></div>
  <!-- ===== /VC SIDEBAR ===== -->

  <header>

    <!-- ===== VC SIDEBAR (desde cero) ===== -->
    <button style="margin-top: 0!important;" id="vc-toggle" class="vc-toggle" aria-label="Mostrar/ocultar menú"
      aria-controls="vc-rail" aria-expanded="false">
      <!--Hamburger icon -->
      <i class="fa fa-bars" aria-hidden="true"></i>


    </button>
    <h1>Laravel ORM Eloquent</h1>
    <img src="" id="logo" alt="Logo" style="display: none;">
  </header>

  <main>

    <!-- SECCIÓN 1 -->
    <section id="introduccion">
      <h2>1. Introducción a Eloquent ORM</h2>

      <p>
        En esta sección comprenderás qué es Eloquent y por qué simplifica el acceso a datos en Laravel.
      </p>

      <p>
        <strong>Eloquent</strong> es el ORM de Laravel. Permite trabajar con la base de datos
        mediante <strong>modelos PHP</strong>, evitando escribir SQL directamente.
        Cada modelo representa una tabla.
      </p>

      <div class="diagram">
        <img src="../assets/laravel_orm.png" style="max-width:35%;" alt="Laravel ORM Logo">
      </div>
      <div class="info-box">
        <h4>⚠️ Importante</h4>
        <ul>
          <li>Un registro o fila de la tabla se corresponderá con un objeto de la clase asociada (entidad)</li>
        </ul>
      </div>
      <div class="diagram">
        <img src="../assets/laravel_orm_intro.png" style="max-width:100%;" alt="Laravel ORM Intro">
      </div>
    </section>

    <!-- SECCIÓN 2 -->
    <section id="model">
      <h2>2. Modelos Eloquent</h2>

      <p>
        Aquí aprenderás a crear y usar modelos para representar tablas y operar con registros.
      </p>

      <h3>2.1. Crear un modelo</h3>

      <pre><code class="language-bash">
php artisan make:model Hotel
</code></pre>

      <h3>2.2. Modelo básico</h3>

      <pre><code class="language-php">
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Hotel extends Model
{
    protected $table = 'hoteles';

    protected $fillable = [
        'nombre',
        'direccion'
    ];
}
</code></pre>

      <h3>2.3. Uso básico del modelo</h3>

      <pre><code class="language-php">
// Insertar
Hotel::create([
    'nombre' => 'Gran Hotel',
    'direccion' => 'Calle Mayor 3'
]);

// Consultar
$hoteles = Hotel::all();

// Buscar por ID
$hotel = Hotel::find(1);

// Eliminar
Hotel::destroy(1);
</code></pre>
    </section>

    <!-- SECCIÓN 3 -->
    <section id="eloquent-crud">
      <h2>3. CRUD con Eloquent</h2>

      <p>
        Verás cómo realizar operaciones básicas de creación, lectura, actualización y borrado con Eloquent.
      </p>

      <h3>3.1. CREATE</h3>
      <pre><code class="language-php">
Hotel::create([
    'nombre' => 'Hotel Central',
    'direccion' => 'Avenida Principal 10'
]);
</code></pre>

      <h3>3.2. READ</h3>
      <pre><code class="language-php">
$hoteles = Hotel::all();
</code></pre>
      <pre><code class="language-php">
$hoteles = Hotel::where('nombre', 'like', '%Hotel%')->get();
</code></pre>

      <h3>3.3. UPDATE</h3>
      <pre><code class="language-php">
$hotel = Hotel::find(1);
$hotel->direccion = 'Nueva dirección';
$hotel->save();
</code></pre>

      <h3>3.4. DELETE</h3>
      <pre><code class="language-php">
$hotel = Hotel::find(1);
$hotel->delete();
</code></pre>
    </section>

    <!-- SECCIÓN 4 -->
    <section id="relaciones">
      <h2>4. Relaciones Eloquent</h2>

      <p>
        Aprenderás a definir relaciones entre modelos para navegar datos conectados.
      </p>

      <h3>4.1. Relación 1:1 (Uno a Uno)</h3>

      <p>
        Una relación 1:1 significa que un registro en una tabla está asociado con exactamente un registro en otra tabla.
        Ejemplo: Un hotel tiene un único gerente.
      </p>

      <h4>Definición en modelos</h4>

      <pre><code class="language-php">
// Hotel.php
public function gerente()
{
    return $this->hasOne(Gerente::class);
}
</code></pre>

      <pre><code class="language-php">
// Gerente.php
public function hotel()
{
    return $this->belongsTo(Hotel::class);
}
</code></pre>

      <h4>Uso de la relación 1:1</h4>

      <pre><code class="language-php">
// Obtener el gerente de un hotel
$hotel = Hotel::find(1);
echo $hotel->gerente->nombre;

// Obtener el hotel de un gerente
$gerente = Gerente::find(1);
echo $gerente->hotel->nombre;

// Crear un gerente para un hotel
$hotel = Hotel::find(1);
$hotel->gerente()->create([
    'nombre' => 'Juan Pérez',
    'email' => 'juan@hotel.com'
]);
</code></pre>

      <h3>4.2. Relación 1:N (Uno a Muchos)</h3>

      <p>
        Una relación 1:N significa que un registro puede tener múltiples registros relacionados.
        Ejemplo: Un hotel tiene muchas habitaciones.
      </p>

      <h4>Definición en modelos</h4>

      <pre><code class="language-php">
// Hotel.php
public function habitaciones()
{
    return $this->hasMany(Habitacion::class);
}
</code></pre>

      <pre><code class="language-php">
// Habitacion.php
public function hotel()
{
    return $this->belongsTo(Hotel::class);
}
</code></pre>

      <h4>Uso de la relación 1:N</h4>

      <pre><code class="language-php">
// Obtener todas las habitaciones de un hotel
$hotel = Hotel::find(1);
foreach ($hotel->habitaciones as $habitacion) {
    echo $habitacion->numero;
}

// Obtener el hotel de una habitación
$habitacion = Habitacion::find(1);
echo $habitacion->hotel->nombre;

// Crear habitaciones para un hotel
$hotel = Hotel::find(1);
$hotel->habitaciones()->create([
    'numero' => '101',
    'tipo' => 'Doble'
]);

// Contar habitaciones de un hotel
$cantidad = $hotel->habitaciones()->count();
</code></pre>

      <h3>4.3. Relación N:M (Muchos a Muchos)</h3>

      <p>
        Una relación N:M significa que múltiples registros pueden estar relacionados con múltiples registros.
        Ejemplo: Un hotel puede tener muchos servicios, y un servicio puede estar en muchos hoteles.
        Requiere una <strong>tabla intermedia</strong> (pivot).
      </p>

      <h4>Estructura de tablas</h4>

      <pre><code class="language-php">
// Migración: create_hoteles_table
Schema::create('hoteles', function (Blueprint $table) {
    $table->id();
    $table->string('nombre');
    $table->string('direccion');
    $table->timestamps();
});

// Migración: create_servicios_table
Schema::create('servicios', function (Blueprint $table) {
    $table->id();
    $table->string('nombre');
    $table->text('descripcion')->nullable();
    $table->timestamps();
});

// Migración: create_hotel_servicio_table (tabla pivot)
Schema::create('hotel_servicio', function (Blueprint $table) {
    $table->id();
    $table->foreignId('hotel_id')->constrained()->onDelete('cascade');
    $table->foreignId('servicio_id')->constrained()->onDelete('cascade');
    $table->decimal('precio_adicional', 8, 2)->nullable(); // Campo extra
    $table->timestamps();
});
</code></pre>

      <h4>Definición en modelos</h4>

      <pre><code class="language-php">
// Hotel.php
public function servicios()
{
    return $this->belongsToMany(Servicio::class)
                ->withPivot('precio_adicional')  // Campos extra de la tabla pivot
                ->withTimestamps();              // Incluir timestamps de pivot
}
</code></pre>

      <pre><code class="language-php">
// Servicio.php
public function hoteles()
{
    return $this->belongsToMany(Hotel::class)
                ->withPivot('precio_adicional')
                ->withTimestamps();
}
</code></pre>

      <h4>Uso de la relación N:M</h4>

      <pre><code class="language-php">
// Obtener servicios de un hotel
$hotel = Hotel::find(1);
foreach ($hotel->servicios as $servicio) {
    echo $servicio->nombre;
    // Acceder a campos de la tabla pivot
    echo $servicio->pivot->precio_adicional;
}

// Obtener hoteles que tienen un servicio
$servicio = Servicio::find(1);
foreach ($servicio->hoteles as $hotel) {
    echo $hotel->nombre;
}

// Asociar servicios a un hotel
$hotel = Hotel::find(1);
$hotel->servicios()->attach(1); // Agregar servicio con ID 1
$hotel->servicios()->attach(2, ['precio_adicional' => 15.00]); // Con datos extra

// Asociar múltiples servicios
$hotel->servicios()->attach([1, 2, 3]);

// Sincronizar servicios (elimina los que no estén en el array)
$hotel->servicios()->sync([1, 2, 3]);

// Desasociar servicios
$hotel->servicios()->detach(1); // Quitar servicio específico
$hotel->servicios()->detach();  // Quitar todos los servicios

// Alternar asociación (si existe lo quita, si no existe lo agrega)
$hotel->servicios()->toggle([1, 2]);

// Verificar si tiene un servicio
if ($hotel->servicios()->where('servicio_id', 1)->exists()) {
    echo "El hotel tiene este servicio";
}
</code></pre>

      <h4>Consultas avanzadas con relaciones N:M</h4>

      <pre><code class="language-php">
// Filtrar por campos de la tabla pivot
$hotelesConServicioCaro = Hotel::whereHas('servicios', function ($query) {
    $query->where('precio_adicional', '>', 20);
})->get();

// Contar servicios de un hotel
$hotel = Hotel::find(1);
$cantidadServicios = $hotel->servicios()->count();

// Actualizar campos de la tabla pivot
$hotel->servicios()->updateExistingPivot($servicioId, [
    'precio_adicional' => 25.00
]);
</code></pre>
    </section>


    <!-- SECCIÓN 5 -->
    <section id="factory">
      <h2>5. Factories con Eloquent</h2>

      <p>
        Esta parte te permite generar datos de prueba de forma rápida y consistente para tus modelos.
      </p>

      <h3>5.1. Crear factory</h3>

      <pre><code class="language-bash">
php artisan make:factory NameClassFactory
</code></pre>

      <h3>5.2. Factory con Faker</h3>

      <pre><code class="language-php">
namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

class HotelFactory extends Factory
{
    public function definition(): array
    {
        return [
            'nombre' => $this->faker->company(),
            'direccion' => $this->faker->address(),
        ];
    }
}
</code></pre>

      <h3>5.3. Usar la factory</h3>

      <pre><code class="language-php">
use App\Models\Hotel;

// Crear un registro
Hotel::factory()->create();

// Crear varios registros
Hotel::factory()->count(10)->create();
</code></pre>
    </section>

    
    <!-- SECCIÓN 6 -->
    <section id="seed">
      <h2>6. Seeders con Eloquent</h2>

      <p>
        Verás cómo poblar la base de datos automáticamente con datos iniciales o de prueba.
      </p>

      <h3>6.1. Crear seeder</h3>

      <pre><code class="language-bash">
php artisan make:seeder HotelSeeder
</code></pre>

      <h3>6.2. Seeder usando Factory</h3>

      <pre><code class="language-php">
use App\Models\Hotel;

class HotelSeeder extends Seeder
{
    public function run(): void
    {
        Hotel::factory()->count(20)->create();
    }
}
</code></pre>

      <h3>6.3. Ejecutar seeders</h3>

      <pre><code class="language-bash">
php artisan db:seed
</code></pre>
    </section>

    <!-- DIAGRAMA -->
    <section>
      <h2>Diagrama conceptual</h2>

      <p>
        Este diagrama resume la relación entre modelos para visualizar la estructura de datos.
      </p>

      <div class="mermaid">
        classDiagram
        class Hotel {
        id
        nombre
        direccion
        }
        class Gerente {
        id
        nombre
        email
        hotel_id
        }
        class Habitacion {
        id
        numero
        tipo
        hotel_id
        }
        class Servicio {
        id
        nombre
        descripcion
        }
        class HotelServicio {
        hotel_id
        servicio_id
        precio_adicional
        }
        Hotel "1" --> "1" Gerente : tiene
        Hotel "1" --> "*" Habitacion : tiene
        Hotel "*" --> "*" Servicio : ofrece
        HotelServicio --> Hotel
        HotelServicio --> Servicio
      </div>
    </section>

    <!-- RESUMEN -->
    <section>
      <div class="info-box">
        <h3>Resumen rápido</h3>

        <table border="1" style="width:100%; border-collapse:collapse;">
          <tr>
            <th>Elemento</th>
            <th>Función</th>
          </tr>
          <tr>
            <td>Model</td>
            <td>Representa una tabla</td>
          </tr>
          <tr>
            <td>Eloquent</td>
            <td>ORM de Laravel</td>
          </tr>
          <tr>
            <td>Factory</td>
            <td>Genera datos con Faker</td>
          </tr>
          <tr>
            <td>Seeder</td>
            <td>Inserta datos automáticamente</td>
          </tr>
          <tr>
            <td>CRUD</td>
            <td>Operaciones con objetos</td>
          </tr>
        </table>
      </div>
    </section>

  </main>

  <footer>
    <p>&copy; Stucom 2025-26. Todos los derechos reservados.</p>
  </footer>
</body>

</html>