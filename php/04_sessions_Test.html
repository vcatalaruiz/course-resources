<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVTW1307T1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-EVTW1307T1');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PHP Sesiones — Test</title>
  <script src="/course-resources/index.js" defer></script>
  <script src="https://kit.fontawesome.com/a7cd9537ed.js" crossorigin="anonymous"></script>
  <script src="../index.js" defer></script>
  <script src="../menu.js" defer></script>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="../menu.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
</head>

<body>

  <nav id="vc-rail" class="vc-rail" aria-hidden="true">
    <div class="vc-rail-head">
      <span class="vc-rail-title">Índice</span>
      <button id="vc-close" class="vc-btn" aria-label="Cerrar menú">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    </div>
    <ul id="vc-list" class="vc-list"></ul>
  </nav>

  <div id="vc-backdrop" class="vc-backdrop" hidden></div>

  <header>
    <button style="margin-top: 0!important;" id="vc-toggle" class="vc-toggle" aria-label="Mostrar/ocultar menú" aria-controls="vc-rail" aria-expanded="false">
      <i class="fa fa-bars" aria-hidden="true"></i>
    </button>
    <h1>PHP Sesiones — Test</h1>
    <img src="" id="logo" alt="Logo" style="display: none;">
  </header>

  <main>

    <section id="intro">
      <h2>1. Instrucciones</h2>
      <div class="quiz-intro">
        <p>Responde las 25 preguntas tipo test sobre <strong>sesiones en PHP</strong>, gestión de estados, cookies y seguridad. Al final podrás ver tu puntuación y la explicación de cada respuesta.</p>
        <div class="quiz-meta">
          <span class="badge">25 preguntas</span>
          <span>Modo: selección única</span>
          <span>Corrección inmediata al enviar</span>
        </div>
      </div>
    </section>

    <section id="test">
      <h2>2. Test de conocimientos</h2>

      <div id="result" class="result-box"></div>

      <form id="quiz-form" class="quiz-container" aria-describedby="result">
        <!-- Preguntas generadas por JS -->
      </form>

      <div class="quiz-actions">
        <button type="button" class="primary" id="check-btn">Corregir</button>
        <button type="button" class="danger" id="reset-btn">Reiniciar</button>
      </div>
    </section>

  </main>

  <footer>
    <p>&copy; Stucom 2025-26. Todos los derechos reservados.</p>
  </footer>

  <script>
    const QUESTIONS = [
      {
        text: "¿Dónde se almacenan los datos de sesión?",
        options: [
          "En el navegador del cliente",
          "En el servidor",
          "En la URL",
          "En la base de datos"
        ],
        answer: 1,
        explanation: "Los datos de sesión se almacenan en el servidor, no en el cliente."
      },
      {
        text: "¿Qué función inicia una sesión en PHP?",
        options: [
          "start_session()",
          "session_start()",
          "session_begin()",
          "init_session()"
        ],
        answer: 1,
        explanation: "session_start() inicia o reanuda una sesión."
      },
      {
        text: "¿Dónde debe llamarse session_start()?",
        options: [
          "Al final del archivo",
          "Después del HTML",
          "Antes de cualquier salida HTML",
          "No importa"
        ],
        answer: 2,
        explanation: "session_start() debe llamarse antes de cualquier salida HTML."
      },
      {
        text: "¿Cuál es el nombre por defecto de la cookie de sesión?",
        options: [
          "SESSION_ID",
          "PHP_SESSION",
          "PHPSESSID",
          "SESSIONID"
        ],
        answer: 2,
        explanation: "PHPSESSID es el nombre por defecto de la cookie de sesión."
      },
      {
        text: "¿Qué variable superglobal se usa para las sesiones?",
        options: [
          "$_SESSION",
          "$_COOKIE",
          "$_SERVER",
          "$_GLOBAL"
        ],
        answer: 0,
        explanation: "$_SESSION es el array superglobal para las sesiones."
      },
      {
        text: "¿Qué función destruye completamente una sesión?",
        options: [
          "session_end()",
          "session_close()",
          "session_destroy()",
          "unset_session()"
        ],
        answer: 2,
        explanation: "session_destroy() destruye todos los datos de la sesión."
      },
      {
        text: "¿Cómo se elimina una variable de sesión específica?",
        options: [
          "delete($_SESSION['var'])",
          "unset($_SESSION['var'])",
          "session_unset('var')",
          "remove($_SESSION['var'])"
        ],
        answer: 1,
        explanation: "unset() elimina una variable de sesión específica."
      },
      {
        text: "¿Qué hace session_unset()?",
        options: [
          "Destruye la sesión",
          "Elimina todas las variables de sesión",
          "Elimina la cookie de sesión",
          "Cierra la sesión"
        ],
        answer: 1,
        explanation: "session_unset() libera todas las variables de sesión."
      },
      {
        text: "¿Qué hace este código?",
        codeBlock: "session_start();\n$_SESSION['user'] = 'Juan';",
        options: [
          "Error",
          "Crea una sesión y almacena el usuario 'Juan'",
          "Destruye la sesión",
          "Elimina el usuario"
        ],
        answer: 1,
        explanation: "Crea una sesión y guarda la variable 'user' con valor 'Juan'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['edad'] = 25;\necho $_SESSION['edad'];",
        options: [
          "Error",
          "25",
          "edad",
          "null"
        ],
        answer: 1,
        explanation: "Accedemos a la variable de sesión 'edad' que contiene 25."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['contador'] = 5;\n$_SESSION['contador'] += 3;\necho $_SESSION['contador'];",
        options: [
          "5",
          "Error",
          "8",
          "3"
        ],
        answer: 2,
        explanation: "Incrementamos el contador de 5 a 8: resultado 8."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['temp'] = 'dato';\nunset($_SESSION['temp']);\necho isset($_SESSION['temp']) ? 'Existe' : 'No existe';",
        options: [
          "Existe",
          "No existe",
          "Error",
          "temp"
        ],
        answer: 1,
        explanation: "Eliminamos 'temp', isset() devuelve false, imprime 'No existe'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['datos'] = ['id' => 1, 'nombre' => 'Ana'];\necho $_SESSION['datos']['nombre'];",
        options: [
          "Error",
          "Ana",
          "1",
          "datos"
        ],
        answer: 1,
        explanation: "Almacenamos un array en sesión y accedemos a 'nombre': 'Ana'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['carrito'] = [];\n$_SESSION['carrito'][] = 'producto1';\necho count($_SESSION['carrito']);",
        options: [
          "Error",
          "1",
          "0",
          "2"
        ],
        answer: 1,
        explanation: "Agregamos 1 elemento al array de sesión, count = 1."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['x'] = 10;\n$_SESSION['y'] = 20;\necho $_SESSION['x'] + $_SESSION['y'];",
        options: [
          "10",
          "Error",
          "30",
          "20"
        ],
        answer: 2,
        explanation: "Leemos dos variables: 10 + 20 = 30."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION = [];\necho empty($_SESSION) ? 'Vacío' : 'Con datos';",
        options: [
          "Con datos",
          "Vacío",
          "Error",
          "null"
        ],
        answer: 1,
        explanation: "Vaciamos el array $_SESSION, empty() retorna true, imprime 'Vacío'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\nif (!isset($_SESSION['logins'])) $_SESSION['logins'] = 0;\n$_SESSION['logins']++;\necho $_SESSION['logins'];",
        options: [
          "Error",
          "1",
          "0",
          "2"
        ],
        answer: 1,
        explanation: "Primera visita: inicializamos a 0 e incrementamos a 1."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['perfil'] = ['rol' => 'admin'];\necho $_SESSION['perfil']['rol'];",
        options: [
          "perfil",
          "admin",
          "Error",
          "rol"
        ],
        answer: 1,
        explanation: "Accedemos a perfil['rol'] que contiene 'admin'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['msg'] = 'Hola';\n$_SESSION['msg'] .= ' Mundo';\necho $_SESSION['msg'];",
        options: [
          "Hola",
          "Error",
          "Hola Mundo",
          "Mundo"
        ],
        answer: 2,
        explanation: "Concatenamos ' Mundo' a 'Hola': resultado 'Hola Mundo'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['a']=1;\n$_SESSION['b']=2;\nunset($_SESSION['a']);\necho isset($_SESSION['b']) ? 'b existe' : 'b no existe';",
        options: [
          "b existe",
          "Error",
          "a existe",
          "b no existe"
        ],
        answer: 0,
        explanation: "Eliminamos 'a' pero 'b' sigue existiendo."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\necho session_status() === PHP_SESSION_ACTIVE ? 'Activa' : 'Inactiva';",
        options: [
          "Inactiva",
          "Error",
          "Activa",
          "null"
        ],
        answer: 2,
        explanation: "Después de session_start(), la sesión está activa."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['id'] = session_id();\necho strlen($_SESSION['id']) > 0 ? 'Tiene ID' : 'Sin ID';",
        options: [
          "Sin ID",
          "Tiene ID",
          "Error",
          "null"
        ],
        answer: 1,
        explanation: "session_id() devuelve una cadena con caracteres, es verdadera."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['count'] = $_SESSION['count'] ?? 0;\n$_SESSION['count']++;\necho $_SESSION['count'];",
        options: [
          "0",
          "Error",
          "1",
          "2"
        ],
        answer: 2,
        explanation: "Primera vez: inicializa a 0 e incrementa a 1."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['user'] = ['perfil' => ['rol' => 'guest']];\necho $_SESSION['user']['perfil']['rol'];",
        options: [
          "user",
          "Error",
          "guest",
          "perfil"
        ],
        answer: 2,
        explanation: "Accedemos a user['perfil']['rol'] que contiene 'guest'."
      },
      {
        text: "¿Cuál es el resultado?",
        codeBlock: "session_start();\n$_SESSION['temp'] = 'valor';\nunset($_SESSION['temp']);\n$_SESSION['temp'] = 'nuevo';\necho $_SESSION['temp'];",
        options: [
          "valor",
          "nuevo",
          "Error",
          "null"
        ],
        answer: 1,
        explanation: "Eliminamos 'temp' y lo recreamos con 'nuevo'."
      }
    ];

    const quizForm = document.getElementById('quiz-form');
    const resultBox = document.getElementById('result');
    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');

    function renderQuiz() {
      quizForm.innerHTML = '';
      QUESTIONS.forEach((q, index) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.dataset.index = index;

        const title = document.createElement('div');
        title.className = 'question-title';
        title.textContent = `${index + 1}. ${q.text}`;

        card.appendChild(title);

        if (q.codeBlock) {
          const codeDiv = document.createElement('div');
          codeDiv.className = 'question-text-code';
          const pre = document.createElement('pre');
          const code = document.createElement('code');
          code.className = 'language-php';
          code.textContent = q.codeBlock;
          pre.appendChild(code);
          codeDiv.appendChild(pre);
          card.appendChild(codeDiv);
        }

        const options = document.createElement('div');
        options.className = 'options';

        q.options.forEach((opt, optIndex) => {
          const label = document.createElement('label');
          label.className = 'option';

          const input = document.createElement('input');
          input.type = 'radio';
          input.name = `q${index}`;
          input.value = optIndex;
          input.setAttribute('aria-label', opt);

          const span = document.createElement('span');
          span.textContent = opt;

          label.appendChild(input);
          label.appendChild(span);
          options.appendChild(label);
        });

        const explanation = document.createElement('div');
        explanation.className = 'explanation';
        explanation.hidden = true;

        card.appendChild(title);
        card.appendChild(options);
        card.appendChild(explanation);
        quizForm.appendChild(card);
      });
      Prism.highlightAllUnder(quizForm);
    }

    function checkAnswers() {
      let correct = 0;

      const cards = quizForm.querySelectorAll('.question-card');
      cards.forEach((card) => {
        const index = Number(card.dataset.index);
        const question = QUESTIONS[index];
        const selected = card.querySelector('input[type="radio"]:checked');
        const options = card.querySelectorAll('.option');
        const explanation = card.querySelector('.explanation');

        options.forEach((opt) => opt.classList.remove('correct', 'incorrect'));

        if (selected) {
          const selectedIndex = Number(selected.value);
          if (selectedIndex === question.answer) {
            correct += 1;
            options[selectedIndex].classList.add('correct');
          } else {
            options[selectedIndex].classList.add('incorrect');
            options[question.answer].classList.add('correct');
          }
        } else {
          options[question.answer].classList.add('correct');
        }

        explanation.textContent = `Explicación: ${question.explanation}`;
        explanation.hidden = false;
      });

      const total = QUESTIONS.length;
      const percent = Math.round((correct / total) * 100);

      resultBox.style.display = 'block';
      resultBox.innerHTML = `
        <h3>Resultado</h3>
        <p>Has acertado <strong>${correct}</strong> de <strong>${total}</strong> preguntas (${percent}%).</p>
        <p>Revisa las explicaciones debajo de cada pregunta.</p>
      `;

      resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    function resetQuiz() {
      renderQuiz();
      resultBox.style.display = 'none';
      resultBox.innerHTML = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    checkBtn.addEventListener('click', checkAnswers);
    resetBtn.addEventListener('click', resetQuiz);

    renderQuiz();
  </script>
</body>
</html>
